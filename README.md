# Mac Monitor Pro & Relay Controller (ESP8266)

这是一个基于 ESP8266 (NodeMCU) 的桌面多功能终端，集成了 **Mac 性能监视器** 和 **双路继电器控制**。
解决了 ESP8266 常见的“上电继电器误触闪烁”问题

## ✨ 功能特性

* **🖥 Mac 监视器**: 实时显示 CPU 波形、内存占用、上传/下载网速 (需配合 Python 脚本)。
* **🔌 Web 中控台**: 手机/电脑浏览器直接控制，支持中英文设备命名。
* **⚡️ 硬件防闪烁**: 继电器接在 D0/D6 安全引脚，彻底消除上电瞬间的“咔哒”误动作。
* **🔄 循环定时**: 支持毫秒级的继电器无限循环通断测试。
* **🌑 深色模式**: 纯黑背景 UI，无光污染，断网自动息屏保护（显示 IP）。
* **📡 OTA 升级**: 支持无线推送固件更新。

---

## 🛠 硬件接线 (Pinout)

**主控**: NodeMCU V2 (ESP8266)  
**屏幕**: 1.3/1.54寸 ST7789 TFT (240x240)

### 1. 继电器接线 (关键防闪烁配置)
| 模块 | 引脚 | 接 NodeMCU | 说明 |
| :--- | :--- | :--- | :--- |
| **设备 1** | IN | **D0** (GPIO 16) | 对应代码 Relay 1 (板载红灯会随动，属正常现象) |
| **设备 2** | IN | **D6** (GPIO 12) | 对应代码 Relay 2 (原 MISO 引脚) |
| **电源** | VCC | 3V3 / VIN | 视继电器电压而定 |

### 2. 屏幕接线 (SPI)
| 屏幕引脚 | 接 NodeMCU | 说明 |
| :--- | :--- | :--- |
| **BLK** (背光) | **3V3** | **直接接电源正极，保持常亮** (勿接 D6) |
| **SCL** (SCK) | **D5** (GPIO 14) | 硬件 SPI 时钟 |
| **SDA** (MOSI) | **D7** (GPIO 13) | 硬件 SPI 数据 |
| **RES** (RST) | **D1** (GPIO 5) | 复位 |
| **DC** | **D2** (GPIO 4) | 数据/命令 |
| **CS** | **D8** (GPIO 15) | 片选 (可选) |

---

## 📦 安装步骤 (Software Setup)

### 第一步：安装 Arduino 环境
1.  下载安装 Arduino IDE。
2.  在“首选项”中添加 ESP8266 开发板管理器地址。
3.  在“库管理器”中搜索并安装以下库：
    * `TFT_eSPI` (By Bodmer)
    * `ESP8266WiFi`
    * `ESP8266WebServer`
    * `ArduinoOTA`

### 第二步：配置屏幕驱动 (非常重要！) ⚠️
由于本项目修改了默认引脚以避让继电器，**必须替换配置文件**：
1.  找到你的 Arduino 库文件夹 (通常在 `文档/Arduino/libraries/TFT_eSPI/`)。
2.  备份该文件夹下的 `User_Setup.h`。
3.  **将本项目附带的 `User_Setup.h` 复制进去并覆盖。**
    * *核心修改点：禁用了 BLK 控制，将 RST/DC 改为了 D1/D2。*

### 第三步：烧录固件
1.  用 USB 线连接 NodeMCU。
2.  开发板选择：`NodeMCU 1.0 (ESP-12E Module)`。
3.  打开 `CPU_Show.ino`，修改 WiFi 名称和密码：
    ```cpp
    WiFiCreds primaryWifi = { "你的WiFi名", "密码" };
    ```
4.  点击上传。

### 第四步：运行 Mac 监控脚本
为了让屏幕显示数据，需要在 Mac 电脑上运行 Python 脚本。
1.  安装依赖：`pip3 install psutil requests`
2.  修改 `monitor.py` 中的 IP 地址为屏幕上显示的 IP。
3.  运行脚本：`python3 monitor.py`

---

## 📱 使用说明
* **Web 控制**: 浏览器访问 `http://[屏幕显示的IP]`。
* **OTA 更新**: 在 Arduino IDE 中选择“网络端口”即可无线刷写代码。
* **复位**: 若更换 WiFi 环境，可修改代码重新烧录，或等待超时自动进入配网模式（视具体逻辑而定）。